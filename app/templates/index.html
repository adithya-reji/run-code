<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code compiler</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>

<body>
    <div class="topbar">
        Code compiler
    </div>

    <div class="main-container">
        <div class="select-lang">
            <div class="lang" id="c">C</div>
            <div class="lang" id="cpp">C++</div>
            <div class="lang" id="python">Python</div>
            <div class="lang" id="java">Java</div>
        </div>

        <div class="editor-container">
            <div class="code-editor" id="codeEditor">
                code editor
            </div>

            <div class="col-resizer" id="colResizer"></div>

            <div class="input-output-container" id="inputOutputContainer">
                <div class="input-container" id="input">Inputs</div>

                <div class="row-resizer" id="rowResizer"></div>

                <div class="output-container" id="output">Output</div>
            </div>
        </div>
    </div>

    <!-- <div class="editor-container">
        <div class="select-lang">
            <div class="lang" id="c">C</div>
            <div class="lang" id="cpp">C++</div>
            <div class="lang" id="python">Python</div>
            <div class="lang" id="java">Java</div>
        </div>

        <div class="code-input-output-container">
            <div class="code-editor-wrapper">
                <div class="line-number" id="codeLineNumber">
                    <span>1</span>
                </div>

                <div class="code-editor">
                    <textarea name="" id="code" placeholder="Code here..."></textarea>
                </div>
            </div>

            <div class="input-output-container">
                <div class="input-container">
                    <div class="input-head">Inputs</div>

                    <div class="input-wrapper">
                        <div class="line-number" id="inputLineNumber">
                            <span>1</span>
                        </div>
                        <div class="input-area">
                            <textarea name="" id="input"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="output-container">
                    <div class="output-head">Output</div>
                </div>
            </div>
        </div>
    </div> -->

    <!-- <div class="select-lang">
        <div class="lang" id="c">C</div>
        <div class="lang" id="cpp">C++</div>
        <div class="lang" id="python">Python</div>
        <div class="lang" id="java">Java</div>
    </div>
    <div class="code-input-output-container">
        <div class="code-container">
            <select id="language-select" name="language" style="display: none;">
                <option value="c">C</option>
                <option value="cpp">C++</option>
                <option value="python">Python</option>
                <option value="java">Java</option>
            </select>

            <textarea name="" id="code" placeholder="Code here..." spellcheck="false"></textarea>
        </div>
        <div class="input-output-container">
            <div class="input-container"></div>
            <div class="output-container"></div>
        </div>
    </div> -->

    <!-- Update line numbers -->
    <script>
        const codeTextArea = document.getElementById("code");
        const codeLineNum = document.getElementById("codeLineNumber");

        const inputTextArea = document.getElementById("input");
        const inputLineNum = document.getElementById("inputLineNumber");

        function updateLineNumber(textarea, lineNum) {
            const lines = textarea.value.split("\n").length;
            lineNum.innerHTML = "";
            for (let i = 1; i <= lines; i++) {
                const span = document.createElement("span");
                span.textContent = i;
                lineNum.appendChild(span);
            }
        }

        function attachLineNumberSync(textarea, lineNum) {
            textarea.addEventListener("input", () => updateLineNumber(textarea, lineNum));
            textarea.addEventListener("scroll", () => lineNum.scrollTop = textarea.scrollTop);
            updateLineNumber(textarea, lineNum);
        }

        attachLineNumberSync(codeTextArea, codeLineNum);
        attachLineNumberSync(inputTextArea, inputLineNum);

        updateLineNumber(codeTextArea, codeLineNum);
        updateLineNumber(inputTextArea, inputLineNum);

    </script>

    <!-- Col & Row Resizer -->
    <Script>
        // COLUMN RESIZER (code editor ↔ input/output)
        const colResizer = document.getElementById('colResizer');
        const editorContainer = document.querySelector('.editor-container');
        const codeEditor = document.getElementById('codeEditor');

        colResizer.addEventListener('mousedown', (e) => {
            document.addEventListener('mousemove', resizeCol);
            document.addEventListener('mouseup', () => {
                document.removeEventListener('mousemove', resizeCol);
            });
        });

        function resizeCol(e) {
            const newWidth = e.clientX;
            codeEditor.style.width = `${newWidth}px`;
            editorContainer.style.gridTemplateColumns = `${newWidth}px 2px 1fr`;
        }

        // ROW RESIZER (input ↕ output)
        const rowResizer = document.getElementById('rowResizer');
        const inputContainer = document.getElementById('input');
        const inputOutputContainer = document.getElementById('inputOutputContainer');

        rowResizer.addEventListener('mousedown', (e) => {
            document.addEventListener('mousemove', resizeRow);
            document.addEventListener('mouseup', () => {
                document.removeEventListener('mousemove', resizeRow);
            });
        });

        function resizeRow(e) {
            const containerTop = inputOutputContainer.getBoundingClientRect().top;
            const offset = e.clientY - containerTop;
            inputContainer.style.height = `${offset}px`;
            inputOutputContainer.style.gridTemplateRows = `${offset}px 2px 1fr`;
        }
    </Script>

    <!-- <script>
        document.getElementById('code').addEventListener('keydown', function (e) {
            if (e.key === "Tab") {
                e.preventDefault();
                const start = this.selectionStart;
                const end = this.selectionEnd;

                const value = this.value;
                const isShift = e.shiftKey;

                // Split value by lines
                const lines = value.substring(start, end).split("\n");

                if (isShift) {
                    // Shift + Tab = unindent
                    for (let i = 0; i < lines.length; i++) {
                        if (lines[i].startsWith("\t")) {
                            lines[i] = lines[i].substring(1);
                        } else if (lines[i].startsWith("    ")) {
                            lines[i] = lines[i].substring(4); // If using spaces for tabs
                        }
                    }
                } else {
                    // Tab = indent
                    for (let i = 0; i < lines.length; i++) {
                        lines[i] = "\t" + lines[i];
                    }
                }

                const newText = lines.join("\n");

                // Replace the selected text
                this.value = value.substring(0, start) + newText + value.substring(end);

                // Recalculate selection range
                if (start !== end) {
                    const lineCount = lines.length;
                    const offset = isShift ? -1 : 1;
                    this.selectionStart = start;
                    this.selectionEnd = end + offset * lineCount;
                } else {
                    this.selectionStart = this.selectionEnd = start + (isShift ? -1 : 1);
                }
            }
        });
    </script>

    <script src="{{ url_for('static', filename='js/detect_lang.js')}}"></script>

    <script>
        const supportedLangs = ['c', 'cpp', 'python', 'java'];
        const codeTextarea = document.getElementById("code");

        codeTextarea.addEventListener("input", () => {
            const code = codeTextarea.value;
            const detectedLang = detectLanguage(code);

            supportedLangs.forEach((lang) => {
                const element = document.getElementById(lang);
                if (element) {
                    if (lang === detectedLang) {
                        element.classList.add("active");
                    } else {
                        element.classList.remove("active");
                    }
                }
            });
        });

    </script>

    <script>
        document.querySelectorAll('.select-lang .lang').forEach(langDiv => {
            langDiv.addEventListener('click', () => {

                document.querySelectorAll('.select-lang .lang').forEach(div => {
                    div.classList.remove('active');
                });

                langDiv.classList.add('active');

                const selectedLanguage = langDiv.id;
                document.getElementById('language-select').value = selectedLanguage;
            });
        });
    </script> -->
</body>

</html>